---
title: Skype によるリアルタイムのメディア通話 |Microsoft Docs
description: Bot Builder SDK for .NET を使用して、Skype でリアルタイムの音声およびビデオでの通話を実行できるボットを作成する場合の、重要な概念について説明します。
author: ssulzer
ms.author: ssulzer
manager: kamrani
ms.topic: article
ms.prod: bot-framework
ms.date: 12/13/2017
monikerRange: azure-bot-service-3.0
ms.openlocfilehash: 255248449ab7adb6512db93ece51389d65c01dee
ms.sourcegitcommit: f576981342fb3361216675815714e24281e20ddf
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/18/2018
ms.locfileid: "39301964"
---
# <a name="real-time-media-calling-with-skype"></a>Skype によるリアルタイム メディア通話

Real-Time Media Platform for Bots は、リアルタイムの音声、ビデオ、および画面共有方式を実現することで、ボットとユーザーの対話方法に新たな領域を追加しています。 これは、説得力のある対話的なエンターテイメント、教育、および支援型のボットを作成する機能を提供します。 ユーザーは Skype を使用して、リアルタイム メディアのボットと通信します。

これは、ボットが*フレーム単位で*音声/ビデオ コンテンツを送受信することを可能にする高度な機能です。 ボットには、音声、ビデオ、画面共有のリアルタイム モダリティに "raw" アクセスできます。 たとえば、ユーザーが話すとき、ボットは 20 ミリ秒 (ms) の音声を含む各フレームを利用して、1 秒あたり 50 個の音声フレームを受信します。 ボットでは、音声フレームを受信したときにリアルタイムで音声認識を実行でき、ユーザーの発話が止まった後に記録のために待機する必要はありません。 また、ボットでは、音声と共に、1 秒あたり 30 フレームの HD 解像度のビデオをユーザーに送信できます。

Real-Time Media Platform for Bots では、ボットが Skype の呼び出し元の音声と (必要に応じて) ビデオ通話に関わることで、Skype Calling Cloud と連動して通話の設定やメディア セッションの確立を処理します。 プラットフォームでは、音声には SILK、ビデオには H.264 などのコーデックを使用して、ボットがメディアを送受信し、リアルタイムでメディアのエンコードおよびデコードを処理できるように、単純な "ソケット" のような API を提供しています。 また、リアルタイム メディアのボットは、複数の参加者による Skype グループ ビデオ通話にも参加できます。

この記事では、Skype でリアルタイムの音声とビデオによる通話を実施できるボットの作成に関して、重要な概念を紹介します。

## <a name="media-session"></a>メディア セッション
リアルタイム メディアのボットが受信した Skype 通話に応答するとき、音声およびビデオの両方の方式をサポートするか、または音声のみをサポートするかを決定します。 サポートされる各方式としては、ボットでは、メディアの送受信両方、受信のみ、または送信のみのいずれかが可能です。 たとえば、ボットで音声は送受信の両方を行うが、(Skype の呼び出し元のビデオを受信しないために) ビデオは送信しか行えない場合があります。 Skype の呼び出し元とボットの間に確立された音声およびビデオの方式設定は、**メディア セッション**と呼ばれます。

"メイン ビデオ" と "画面共有" という 2 つのビデオ方式がサポートされています。 メイン ビデオでは、ボットが生成したビデオを呼び出し元に送信 (再生) し、呼び出し元のビデオ (通常はユーザーの Web カメラから) をボットに送信します。 画面共有方式では、呼び出し元がボットと画面を (ビデオとして) 共有できます。 ボットは、ビデオを共有している画面をユーザーに送信できません。

マルチパーティの Skype **グループ ビデオ通話** に参加した場合、リアルタイム メディア ボットでは、複数のメイン ビデオ ストリームの同時受信をサポートします。 これにより、グループ ビデオ通話でボットを複数の参加者に "表示" できます。

## <a name="frames-and-frame-rate"></a>フレームとフレーム レート
リアルタイム メディアのボットは、音声およびビデオ方式の Skype 通話と直接やり取りします。 つまり、メディアの送受信のいずれかまたは両方を**フレーム**のシーケンスとして送信しています。このとき、各フレームはコンテンツの 1 つの単位を表します。 1 秒の音声は 20 ミリ秒 (ms) (1 秒の 50 分の 1) を含む各フレームを使って、50 個のフレームのシーケンスとして送信できます。 1 分間に相当するビデオは、30 個の静止画像のシーケンスとしてスライスでき、各画像は、次のビデオ フレームが表示されるまで 33 ミリ秒 (1 秒の 30 分の 1 ) 間表示されることを意図しています。 1 秒ごとに送信またはレンダリングされるフレーム数は、**フレーム レート**と呼ばれます。 "30fps" は、1 秒あたり 30 個のフレームを示します。

## <a name="audio-format"></a>音声の形式
各秒の音声は、16,000 個の**サンプル**として表され、各サンプルには 16 ビットのデータが格納されています。 20 ミリ秒の音声フレームには、320 個のサンプル (640 バイトのデータ) が含まれています。

## <a name="video-format"></a>ビデオの形式
ビデオでは複数の形式がサポートされています。 ビデオの形式には、**フレーム サイズ**と**色形式**という 2 つの重要なプロパティがあります。 サポートされているフレーム サイズとして、640x360 ("360p")、1280x720 ("720p")、および 1920x1080 ("1080p") があります。 サポートされている色形式として、NV12 (1 ピクセルあたり 12 ビット) および RGB24 (1 ピクセルあたり 24 ビット) があります。

"720 p" のビデオ フレームには、921,600 ピクセル (1280 × 720) が含まれています。 RGB24 の色形式では、各ピクセルは 3 バイト (24 ビット) で表され、各バイトは赤、緑、および青の色要素で構成されます。 そのため、単一の 720 p の RGB24 ビデオ フレームでは、2,764,800 バイトのデータ (921,600 ピクセル× 3 バイト/ピクセル) が必要になります。 30 fps のフレーム レートでは、720 p の RGB24 ビデオ フレームを送信することは、約 80 MB/秒のコンテンツを処理することを意味します (実際は、ネットワーク送信前に H.264 ビデオ コーデックで圧縮されます)。

## <a name="active-and-dominant-speakers"></a>アクティブな発話者と優勢な発話者
複数の参加者で構成される Skype グループ ビデオ通話に参加する場合、ボットは、どの参加者が現在発話しているかを特定できます。 **アクティブな発話者**は、受信した各音声フレームでどの参加者の声が聞かれているかを特定します。 **優勢な発話者**は、どのオーディオ フレームでも声が聞こえるわけではなくても、グループの会話でどの参加者が現在最も活発か ("優勢" か) を特定します。 別の参加者が発話する番になると、優勢な発話者が変わる場合があります。

## <a name="video-subscription"></a>ビデオ サブスクリプション
単一の Skype 呼び出し元の通話では、ボットは自動的に呼び出し元のビデオを受信します (ボットで、メイン ビデオの受信が有効になっている場合)。 マルチパーティの Skype グループ ビデオ通話では、リアルタイム メディア プラットフォームに対してどの参加者を表示するかを、ボットが指示する必要があります。 ビデオ サブスクリプションは、参加者のビデオを受信するためのボットからの要求です。 グループ ビデオ通話の参加者が会話を実施している場合、ボットは、優勢な発話者の設定の更新情報に基づいて、目的のビデオ サブスクリプションを変更できます。

## <a name="developer-resources"></a>開発者リソース 

### <a name="sdks"></a>SDK

リアルタイム メディア ボットを開発するには、Visual Studio プロジェクト内に以下の NuGet パッケージをインストールする必要があります。

- [Bot Builder SDK for .NET](bot-builder-dotnet-overview.md)
- [Bot Builder Real-Time Media Calling for .NET](https://www.nuget.org/packages?q=Bot.Builder.RealTimeMediaCalling)
- [Microsoft.Skype.Bots.Media .NET ライブラリ](https://www.nuget.org/packages?q=Microsoft.Skype.Bots.Media)

### <a name="code-samples"></a>コード サンプル

[BotBuilder-RealTimeMediaCalling](https://github.com/Microsoft/BotBuilder-RealTimeMediaCalling) の GitHub リポジトリには、Skype のリアルタイム メディア ボットの作成方法を示すサンプルが含まれています。
