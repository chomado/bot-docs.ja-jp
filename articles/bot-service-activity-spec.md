---
title: Bot Framework の仕様 | Microsoft Docs
description: Bot Framework の仕様
author: RobStand
ms.author: kamrani
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.subservice: sdk
ms.date: 03/07/2018
ms.openlocfilehash: 06e2289dd0176364467d34846ffa7716483f6578
ms.sourcegitcommit: b78fe3d8dd604c4f7233740658a229e85b8535dd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2018
ms.locfileid: "50000409"
---
# <a name="bot-framework----activity"></a>Bot Framework -- Activity

## <a name="abstract"></a>要約

Bot Framework Activity スキーマは、人間と自動化されたソフトウェアによって行われる会話アクションのアプリケーションレベルの表現です。 スキーマには、テキスト、マルチメディア、非コンテンツ アクション (ソーシャル インタラクションやタイピング インジケーターなど) を伝達するための規定が含まれています。

このスキーマは、Bot Framework プロトコル内で使用され、Microsoft のチャット システムと、さまざまな製造元の相互運用可能なボットやクライアントによって実装されています。

## <a name="table-of-contents"></a>目次

1. [はじめに](#introduction)
2. [アクティビティの基本構造](#basic-activity-structure)
3. [メッセージ アクティビティ](#message-activity)
4. [連絡先関係の更新アクティビティ](#contact-relation-update-activity)
5. [会話の更新アクティビティ](#conversation-update-activity)
6. [会話の終了アクティビティ](#end-of-conversation-activity)
7. [イベント アクティビティ](#event-activity)
8. [呼び出しアクティビティ](#invoke-activity)
9. [インストールの更新アクティビティ](#installation-update-activity)
10. [メッセージの削除アクティビティ](#message-delete-activity)
11. [メッセージの更新アクティビティ](#message-update-activity)
12. [メッセージの反応アクティビティ](#message-reaction-activity)
13. [入力アクティビティ](#typing-activity)
14. [複合アクティビティ](#complex-types)
15. [参照](#references)
16. [付録 I - 変更](#appendix-i---changes)
17. [付録 II - 非 IRI エンティティ型](#appendix-ii---non-iri-entity-types)
18. [付録 III - 呼び出しアクティビティを使用するプロトコル](#appendix-iii---protocols-using-the-invoke-activity)

## <a name="introduction"></a>はじめに

### <a name="overview"></a>概要

Bot Framework Activity スキーマは、チャット アプリケーション、電子メール、および他のテキスト インタラクション プログラム内で人間と自動化されたソフトウェアによって行われる会話動作を表します。 各アクティビティ オブジェクトには種類フィールドが含まれます。各オブジェクトは単一のアクションを表します。最も一般的な例として、テキスト コンテンツの送信をはじめ、マルチメディアの添付ファイル、"いいね!" ボタンやタイピング インジケーターなどの非コンテンツ動作があります。

このドキュメントでは、アクティビティの各種類の意味と、含めることができる必須のフィールドと省略可能なフィールドについて説明します。 また、クライアントとサーバーのロールを定義し、各参加者がマスターするフィールド、無視してもよいフィールドについてのガイダンスを提供します。

この仕様には、3 つの重要なロールがあります。ユーザーに代わってアクティビティを送受信するクライアント、アクティビティを送受信し、通常は自動化されているボット、アクティビティを格納し、クライアントとボット間で転送するチャネルです。

この仕様では、ロール間でアクティビティを送信する必要がありますが、その送信の正確な性質についてはここでは説明しません。

簡潔にするために、この仕様では、視覚的なインタラクティブ カードを定義していません。 代わりに、[Adaptive Cards](https://adaptivecards.io) [[11](#references)] 仕様を参照してください。 このカードや他の未定義の種類のカードが、Bot Framework アクティビティ内に添付ファイルとして含まれている可能性があります。

### <a name="requirements"></a>必要条件

このドキュメントで使用するキーワード "MUST (する必要があります)"、"MUST NOT (してはなりません)"、"REQUIRED (必要です)"、"SHALL (するものとします)"、"SHALL NOT (するものではありません)"、"SHOULD (すべきです)"、"SHOULD NOT (すべきではありません)"、"RECOMMENDED (推奨されます)"、"MAY (することができます)"、"OPTIONAL (オプション)" は、[RFC 2119](https://tools.ietf.org/html/rfc2119) [[1](#references)] の説明どおりに解釈するものとします。

実装するプロトコルの MUST または REQUIRED レベル要件の 1 つまたは複数を満たしていない場合、その実装は準拠していません。 そのプロトコルのすべての MUST または REQUIRED レベル要件とすべての SHOULD レベル要件を満たしている実装は、"無条件に準拠している" と見なされます。そのプロトコルのすべての MUST レベル要件を満たしていますが、すべての SHOULD レベル要件を満たしていない場合は、"条件付きで準拠している" と見なされます。

### <a name="numbered-requirements"></a>番号付きの要件

`RXXXX` という形式のマーカーで始まる行は、本ドキュメント以外の場で議論される場合に番号で参照できるように指定された個別の要件です。 これらの要件は、`RXXXX` 行以外に記載されている規範的な記述と同程度の重みを持ちます。

`R1000`: この仕様の編集者は新しい `RXXXX` 要件を追加することができます (MAY)。 編集者は、ドキュメントのフローを保持する数値 `RXXXX` を見つけるべきです (SHOULD)。

`R1001`: 編集者は既存の `RXXXX` 要件の番号を変更してはなりません (MUST NOT)。

`R1002`: 編集者は `RXXXX` 要件を削除または改訂することができます (MAY)。 要件の主題の大部分が損なわれていない限り、編集者は改訂する場合に既存の `RXXXX` 値を保持すべきです (SHOULD)。

`R1003`: 編集者は廃止された `RXXXX` 値を再使用すべきではありません (SHOULD NOT)。 削除された値の一覧は、このドキュメントの末尾で保守することができます (MAY)。

### <a name="terminology"></a>用語集

activity
> Activity スキーマに準拠するボット、チャネル、またはクライアントが表現するアクション。

channel
> アクティビティを送受信し、それをチャットやアプリケーションの動作との間で変換するソフトウェア。 チャネルは、アクティビティ データの権限のあるストアです。

ボット
> アクティビティを送受信し、自動化された応答、半自動化された応答、または完全に手動の応答を生成するソフトウェア。 ボットにはチャネルに登録されたエンドポイントがあります。

クライアント
> (通常は人間に代わって) アクティビティを送受信するソフトウェア。 クライアントにエンドポイントはありません。

送信者
> アクティビティを送信するソフトウェア。

受信者
> アクティビティを受信するソフトウェア。

endpoint
> ボットやチャネルがアクティビティを受信できる、プログラムでアドレス指定可能な場所。

address
> ユーザーまたはボットに連絡できる識別子またはアドレス。

フィールド
> アクティビティまたは入れ子になったオブジェクト内の名前付き値。

### <a name="overall-organization"></a>全体的な構成

アクティビティ オブジェクトは、名前/値ペアの単純なリストです。一部はプリミティブ オブジェクトであり、一部は複合 (入れ子になった) オブジェクトです。 アクティビティ オブジェクトは、一般的に JSON 形式で表現されていますが、.NET または JavaScript のインメモリ データ構造にプロジェクションすることもできます。

アクティビティの `type` フィールドは、アクティビティの意味とそのアクティビティに含まれるフィールドを制御します。 参加者が演じているロール (クライアント、ボット、またはチャネル) によって、各フィールドは必須または省略可能になるか、無視されます。 たとえば、`id` フィールドはチャネルが制御します。状況によっては必須ですが、ボットから送信された場合は無視されます。

`type` フィールドや `from` フィールドなど、アクティビティやすべての参加者の ID を記述するフィールドは、すべてのアクティビティで共有されます。 多くのプログラミング言語では、他のより具体的なアクティビティ タイプの派生元となるコア ベース タイプに基づいてこれらのフィールドを整理すると便利です。

アクティビティを格納または送信する場合、転送メカニズム内で一部のフィールドが重復することがあります。 たとえば、アクティビティが HTTP POST を介して会話 ID を含む URL に送信される場合、受信者は、アクティビティの本文内にその値がなくても、値を推論することができます。 このドキュメントでは、このようなフィールドの抽象的な要件についてのみ説明します。値を明示的に宣言する必要があるかどうか、または暗黙的な値または推測された値が許可されるかどうかを決定するのは、制御側のプロトコル次第です。

ボットまたはクライアントがチャネルにアクティビティを送信するときは、通常、アクティビティの記録を求める要求です。 チャネルがボットまたはクライアントにアクティビティを送信するときは、通常、アクティビティが既に記録されていることを示す通知です。

## <a name="basic-activity-structure"></a>アクティビティの基本構造

このセクションでは、アクティビティ オブジェクトの基本構造の要件を定義します。

アクティビティ オブジェクトには、フィールドと呼ばれる名前/値ペアの単純なリストが含まれています。 フィールドはプリミティブ型にすることができます。 一般的な交換形式として JSON が使用されています。すべてのアクティビティを常に JSON にシリアル化する必要はありませんが、JSON にシリアル化可能にする必要があります。 こうすることで、実装は単純な一連の会話で既知および未知のアクティビティ フィールドを処理できるようになります。

`R2001`: フィールドの一意性の制約に準拠することを含め、アクティビティは JSON 形式にシリアル化可能する必要があります (MUST)。

`R2002`: 受信者は、大文字と小文字が正しくないフィールド名を許可することができます (MAY) が、これは必須ではありません。 受信者は、大文字と小文字が正しいフィールドを含まないアクティビティを拒否することができます (MAY)。

`R2003`: 受信者は、値の型がこの仕様に記載されている値の型と一致しないフィールド値を含むアクティビティを拒否することができます (MAY)。

`R2004`: 特に明記されていない限り、送信者は、文字列フィールドに空の文字列値を含めるべきではありません (SHOULD NOT)。

`R2005`: 特に明記されていない限り、送信者は、アクティビティまたは入れ子になった複合オブジェクト内に追加フィールドを含めることができます (MAY)。 受信者は、理解できないフィールドを受け入れる必要があります (MUST)。

`R2006`: 受信者は、理解できない種類のイベントを受け入れるべきです (SHOULD)。

### <a name="type"></a>type

`type` フィールドは、各アクティビティの意味を制御します。また、慣例により、短い文字列 (例: "`message`") です。 送信者は、独自のアプリケーションレイヤーの型を定義できますが、今後定義される値と衝突する可能性の低い値を選択することをお勧めします。 送信者が型の値として URI を使用する場合、等価性を確立するために URI のラダー比較を実装すべきではありません (SHOULD NOT)。

`R2010`: アクティビティには、文字列値型の `type` フィールドを含める必要があります (MUST)。

`R2011`: 2 つの `type` 値は、順序が同一の場合にのみ、等価です。

`R2012`: 送信者は、このドキュメントで定義されていないアクティビティの `type` 値を生成することができます (MAY)。

`R2013`: チャネルは、理解できない種類のアクティビティを拒否すべきです (SHOULD)。

`R2014`: ボットまたはクライアントは、理解できない種類のアクティビティを無視すべきです (SHOULD)。

### <a name="channel-id"></a>チャネル ID

`channelId` フィールドは、アクティビティのチャネルと権限のあるストアを確立します。 `channelId` フィールドの値は文字列型です。

`R2020`: アクティビティには、文字列値型の `channelId` フィールドを含める必要があります (MUST)。

`R2021`: 2 つの `channelId` 値は、順序が同一の場合にのみ、等価です。

`R2022`: チャネルは、期待する `channelId` 値を含まないアクティビティを受信した場合に、そのアクティビティを無視または拒否することができます (MAY)。

### <a name="id"></a>ID

アクティビティがチャネルに記録されると、`id` フィールドはアクティビティの ID を確立します。 まだ記録されていない実行中のアクティビティに ID はありません。 すべてのアクティビティに ID が割り当てられるわけではありません (たとえば、[入力アクティビティ](#typing-activity)に `id` を割り当てることはできません)。`id` フィールドの値は文字列型です。

`R2030`: そのアクティビティに `id` フィールド使用できる場合、チャネルはそのフィールドを含めるべきです (SHOULD)。

`R2031`: クライアントとボットは、生成するアクティビティに `id` フィールドを含めるべきではありません (SHOULD NOT)。

実装を簡易にするために、他の参加者はアクティビティ ID の高度な知識を持たず、等価性の確立に順序比較のみを使用することを前提とすべきです。

たとえば、チャネルは、各アクティビティ ID に対して 16 進でエンコードされた GUID を使用することがあります。 大文字でエンコードされた GUID が小文字でエンコードされた GUID と論理的に等価であっても、可能な限り、送信者はこのような代替エンコーディングを使用すべきではありません (SHOULD NOT)。 各 ID の正規化されたバージョンは、権限のあるストアであるチャネルによって確立されます。

`R2032`: `id` 値を生成する場合、送信者は、順序比較によって等価性を確立できる値を選択すべきです (SHOULD)。 ただし、送信者と受信者は、状況について特別な知識を持っている場合、順序が等価ではない 2 つの値の論理的等価性を許可することができます (MAY)。

`id` フィールドは重複除去を許可するように設計されていますが、ほとんどのアプリケーションでは禁止されています。

`R2033`: 受信者は、ID でアクティビティの重複を除去できます (MAY)。ただし、送信者は、受信者がこの重複除去を実行することに頼るべきではありません (SHOULD NOT)。

### <a name="timestamp"></a>Timestamp

`timestamp` フィールドには、アクティビティが発生したときの正確な UTC 時刻が記録されます。 コンピューティング システムに分散型の性質があるため、チャネル (権限のあるストア) がアクティビティを記録するときが重要です。 クライアントまたはボットがアクティビティを開始した時刻は、`localTimestamp` フィールドで個別に送信されることがあります。 `timestamp` フィールドの値は、文字列内で [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) [[2](#references)] でエンコードされた日時です。

`R2040`: そのアクティビティに `timestamp` フィールド使用できる場合、チャネルはそのフィールドを含めるべきです (SHOULD)。

`R2041`: クライアントとボットは、生成するアクティビティに `timestamp` フィールドを含めるべきではありません (SHOULD NOT)。

`R2042`: アクティビティが順序どおりではないように見える場合、クライアントとボットは `timestamp` を使用してアクティビティを拒否すべきではありません (SHOULD NOT)。 ただし、`timestamp` を使用して、UI 内またはダウンストリーム処理のためにアクティビティの順序を変更できます (MAY)。

`R2043`: 送信者は、`timestamp` フィールドの値を常に UTC 形式ですべきです (SHOULD)。また、値内に明示的な UTC マークとして Z を含めるべきです (SHOULD)。

### <a name="local-timestamp"></a>ローカル タイムスタンプ

`localTimestamp` フィールドは、アクティビティが生成された日時とタイムゾーンのオフセットを表します。 これは、アクティビティが記録された UTC `timestamp` と異なる場合があります。 `localTimestamp` フィールドの値は、文字列内で ISO 8601 [[3](#references)] でエンコードされた日時です。

`R2050`: クライアントとボットは、そのアクティビティに `localTimestamp` フィールドを含めることができます (MAY)。 また、エンコードされた値内にタイムゾーンのオフセットを明示的に列挙すべきです (SHOULD)。

`R2051`: チャネルは、送信者から受信者にアクティビティを転送するときに `localTimestamp` を保持すべきです (SHOULD)。

### <a name="from"></a>ソース

`from` フィールドは、アクティビティを生成したクライアント、ボット、またはチャネルを表します。 `from` フィールドの値は、[チャネル アカウント](#channel-account)型の複合オブジェクトです。

`from.id` フィールドは、誰がアクティビティを生成したかを識別します。 ほとんどの場合、これはシステム内の別のユーザーまたはボットです。 場合によっては、`from` フィールドはチャネル自体を識別します。

`R2060`: チャネルは、アクティビティを生成するときに、`from` および `from.id` フィールドを含める必要があります (MUST)。

`R2061`: ボットとクライアントは、アクティビティを生成するときに、`from` および `from.id` フィールドを含めるべきです (SHOULD)。 チャネルは、`from` および `from.id` フィールドが欠落していることでアクティビティを拒否することができます (MAY)。

`from.name` フィールドは省略可能であり、チャネル内のアカウントの表示名を表します。 クライアントとボットが UI とバックエンド システムを設定できるように、チャネルはこの値を含めるべきです (SHOULD)。 ボットとクライアントは、このストアの中央レコードを持つチャネルにこの値を送信すべきではありません (SHOULD NOT) が、すべてのアクティビティに値を設定するチャネル (たとえば電子メールチャネル) にこの値を送信することができます (MAY)。

`R2062`: `from` フィールドが存在し、`from.name` を使用できる場合、チャネルは `from.name` フィールドを含めるべきです (SHOULD)。

`R2063`: ボットとクライアントは、チャネル内で意味的に価値がある場合を除き、`from.name` フィールドを含めるべきではありません (SHOULD NOT)。

### <a name="recipient"></a>Recipient

`recipient` フィールドは、このアクティビティを受信しているクライアントまたはボットを表します。 このフィールドは、アクティビティが 1 人の受信者のみに送信された場合に限り意味があります。(アクティビティがチャネルに送信された場合のように) 複数の受信者にブロードキャストされた場合は意味がありません。 このフィールドの目的は、受信者が自分自身を識別できるようにすることです。 これは、クライアントまたはボットがチャネル内に複数の ID を持っている場合に役立ちます。 `recipient` フィールドの値は、[チャネル アカウント](#channel-account)型の複合オブジェクトです。

`R2070`: チャネルは、単一の受信者にアクティビティを送信するときに、`recipient` および `recipient.id` フィールドを含める必要があります (MUST)。

`R2071`: ボットとクライアントは、アクティビティを生成するときに、`recipient` フィールドを含めるべきではありません (SHOULD NOT)。

`recipient.name` フィールドは省略可能であり、チャネル内のアカウントの表示名を表します。 クライアントとボットが UI とバックエンド システムを設定できるように、チャネルはこの値を含めるべきです (SHOULD)。

`R2072`: `recipient` フィールドが存在し、`recipient.name` を使用できる場合、チャネルは `recipient.name` フィールドを含めるべきです (SHOULD)。

### <a name="conversation"></a>会話

`conversation` フィールドは、アクティビティが存在する会話を表します。 `conversation` フィールドの値は、[会話アカウント](#conversation-account)型の複合オブジェクトです。

`R2080`: チャネル、ボット、およびクライアントは、アクティビティを生成するときに、`conversation` および `conversation.id` フィールドを含める必要があります (MUST)。

`conversation.name` フィールドは省略可能であり、存在し、使用できる場合は、会話の表示名を表します。

`R2081`: チャネルは、使用できる場合に `conversation.name` および `conversation.isGroup` フィールドを含めるべきです (SHOULD)。

`R2082`: ボットとクライアントは、チャネル内で意味的に価値がある場合を除き、`conversation.name` フィールドを含めるべきではありません (SHOULD NOT)。

`R2083`: ボットとクライアントは、生成するアクティビティに `conversation.isGroup` フィールドを含めるべきではありません (SHOULD NOT)。

### <a name="reply-to-id"></a>返信先 ID

`replyToId` フィールドは、現在のアクティビティが返信である以前のアクティビティを識別します。 このフィールドでは、スレッド化された会話とコメントの入れ子を参加者間で通信できます。 `replyToId` は現在の会話内でのみ有効です (他の会話の参照については、[relatesTo](#relates-to) を参照してください)。`replyToId` フィールドの値は文字列です。

`R2090`: 送信者は、別のアクティビティへの返信である場合、そのアクティビティに `replyToId` を含めるべきです (SHOULD)。

`R2091`: その `replyToId` が会話内の有効なアクティビティを参照していない場合、チャネルはアクティビティを拒否できます (MAY)。

`R2092`: 送信されているアクティビティが別のアクティビティへの返信であっても、チャネルがフィールドを利用していないことがわかっている場合、ボットとクライアントは `replyToId` を省略することができる (MAY)。

### <a name="entities"></a>エンティティ

`entities` フィールドには、このアクティビティに関するメタデータ オブジェクトの単純なリストが含まれています。 添付ファイルとは異なり ([attachments](#attachments) フィールドを参照してください)、エンティティは必ずしもユーザーが対話可能なコンテンツ要素として現れる訳ではなく、理解できない場合は無視されることが意図されています。 送信者は、受信者が受け入れることができるかどうかについて自信がない場合でも、受信者にとって有益と考えられるエンティティを含めることができます。 各 `entities` リスト要素の値は、[エンティティ](#entity)型の複合オブジェクトです。

`R2100`: 送信者は、要素を含まない場合、`entities` フィールドを省略すべきです (SHOULD)。

`R2101`: エンティティが明確な意味を持っている場合、送信者は同じ種類の複数のエンティティを送信することができます (MAY)。

`R2102`: 送信者は、同じ種類とコンテンツのエンティティを複数含めてはなりません (MUST)。

`R2103`: 送信者と受信者は、アクティビティに含まれるエンティティの特定の順序に依存すべきではありません (SHOULD NOT)。

### <a name="channel-data"></a>チャネル データ

アクティビティ スキーマ内の拡張データは、主に `channelData` フィールド内で構成されています。 これにより、プロトコルを実装する SDK のプラミングが簡易になっています。 `channelData` オブジェクトの形式は、アクティビティを送信または受信するチャネルによって定義されます。

`R2200`: チャネルは JSON プリミティブ (たとえば、文字列、int) である `channelData` 形式を定義すべきではありません (SHOULD NOT)。 代わりに、`channelData` を複合型として定義するか、未定義のままにしておくべきです (SHOULD)。

`R2201`: `channelData` 形式が現在のチャネルについて定義されていない場合、受信者は `channelData` のコンテンツを無視すべきです (SHOULD)。

### <a name="service-url"></a>サービス URL

アクティビティは頻繁に非同期に送信され、トラフィックの送受信には別のトランスポート接続が使用されます。 `serviceUrl` フィールドは、現在のアクティビティへの返信が送信される URL を示すためにチャネルによって使用されます。 `serviceUrl` フィールドの値は文字列型です。

`R2300`: チャネルは、ボットに送信するすべてのアクティビティに `serviceUrl` フィールドを含める必要があります (MUST)。

`R2301`: チャネルは、既にチャネルのエンドポイントを知っていることを示しているクライアントに対して `serviceUrl` フィールドを含めるべきではありません (SHOULD NOT)。

`R2302`: ボットとクライアントは、生成するアクティビティの `serviceUrl` フィールドを設定すべきではありません (SHOULD NOT)。

`R2302`: チャネルは、ボットとクライアントから送信されたアクティビティの `serviceUrl` の値を無視する必要があります (MUST)。

`R2304`: ボットは `serviceUrl` フィールドの値を長期間維持する可能性があるので、チャネルは、そのフィールドに安定した値を使用すべきです (SHOULD)。

## <a name="message-activity"></a>メッセージ アクティビティ

メッセージ アクティビティは、会話インターフェイス内に表示されることを意図したコンテンツを表します。 メッセージ アクティビティには、テキスト、音声、インタラクティブ カード、バイナリまたは未知の添付ファイルが含まれる場合があります。メッセージ アクティビティの形式が適切に設定されるためには、通常、チャネルにはこれらの 1 つのみが必要です。

メッセージ アクティビティは、`message` の `type` 値で識別されます。

### <a name="text"></a>Text

`text` フィールドには、マークダウン形式、XML 形式、またはプレーン テキスト形式のテキスト コンテンツが含まれています。 形式は [`textFormat`](#text-format) フィールドによって制御され、未指定またはあいまいな場合はプレーンです。 `text` フィールドの値は文字列型です。

`R3000`: `text` フィールドは、コンテンツなしの送信テキストを示す空の文字列を含めることができます (MAY)。

`R3001`: チャネルは、`markdown` 形式のテキストをそのチャネルに対して適切にデグレードするように処理すべきです (SHOULD)。

### <a name="text-format"></a>テキスト形式

`textFormat` フィールドは、[`text`](#text) フィールドを[マークダウン](https://daringfireball.net/projects/markdown/) [[ 4](#references)]、プレーン テキスト、または XML のいずれかと解釈すべきであることを示します。 `textFormat` フィールドの値は文字列型であり、`markdown`、`plain`、`xml` の値が定義されています。 既定値は `plain` です。 このフィールドは、任意の値で拡張されるようには設計されていません。

`textFormat` フィールドは、添付ファイル内などの追加フィールドを制御します。このリレーションシップについては、このドキュメントの他のフィールド内で説明されています。

`R3010`: 送信者が `textFormat` フィールドを含める場合、定義された値のみを送信すべきです (SHOULD)。

`R3011`: 値が `plain` の場合、送信者は `textFormat` を省略すべきです (SHOULD)。

`R3012`: 受信者は未定義の値を `plain` と解釈すべきです (SHOULD)。

`R3013`: ボットとクライアントは、チャネルがサポートしていることと、サポートされる XML 方言の特性を事前に知っている場合を除き、値 `xml` を送信すべきではありません (SHOULD NOT)。

`R3014`: チャネルは `markdown` または `xml` のコンテンツをボットに送信すべきではありません (SHOULD NOT)。

`R3015`: チャネルは、少なくとも `plain` と `markdown` の `textformat` 値を受け入れるべきです (SHOULD)。

`R3016`: チャネルは値 `xml` の `textformat` を拒否することができます (MAY)。

### <a name="locale"></a>ロケール

`locale` フィールドは、[`text`](#text) フィールドの言語コードを伝達します。 `locale` フィールドの値は、文字列内で [ISO 639](https://www.iso.org/iso-639-language-codes.html) [[5](#references)] でエンコードされた日時です。

`R3020`: 受信者は、`locale` フィールドの欠落した値と未知の値を未知として扱うべきです (SHOULD)。

`R3021`: 受信者は不明なロケールのアクティビティを拒否すべきではありません (SHOULD NOT)。

### <a name="speak"></a>Speak

`speak` フィールドは、音声合成システムを介して話すアクティビティの方法を示します。 このフィールドは、既定値が不適切と判断された場合に、音声レンダリングをカスタマイズするために使用されます。 テキスト、添付ファイル、要約など、アクティビティ内のすべてのコンテンツの音声合成を置き換えます。 `speak` フィールドの値は、文字列内で [SSML](https://www.w3.org/TR/speech-synthesis/) [[6](#references)] でエンコードされた日時です。 ラップされていないテキストは許可され、ベア SSML に自動的にアップグレードされます。

`R3030`: `speak` フィールドは、音声が生成されないことを示す空の文字列を含めることができます (MAY)。

`R3031`: 音声を生成できない受信者は `speak` フィールドを無視すべきです (SHOULD)。

`R3032`: ルート SSML 要素が見つからない場合、受信者は、含まれているテキストを、有効な [XML Prolog](https://www.w3.org/TR/xml/#sec-prolog-dtd) [[7](#references)] で始まる SSML `<speak>` タグ内部のコンテンツと見なし、それ以外の場合は、有効な SSML ドキュメントにアップグレードされるものと見なす必要があります (MUST)。

`R3033`: 受信者は、通信された XML フラグメント以外のリモート リソースを含めるために、XML DTD またはスキーマ解決を使用すべきではありません (SHOULD NOT)。

`R3034`: チャネルは、`speak` フィールドをボットに送信すべきではありません (SHOULD NOT)。

### <a name="input-hint"></a>入力ヒント

`inputHint` フィールドは、アクティビティのジェネレーターが応答を予期しているかどうかを示します。 このフィールドは、モーダル ユーザー インターフェイスがあるチャネル内で主に使用され、通常、連続チャット フィードを使用するチャネルでは使用されません。 `inputHint` フィールドの値は文字列型であり、`accepting`、`expecting`、`ignoring` の値が定義されています。 既定値は `accepting` です。

`R3040`: 送信者が `inputHint` フィールドを含める場合、定義された値のみを送信すべきです (SHOULD)。

`R3041`: `inputHint` が使用されているチャネルにアクティビティを送信する場合、値が `accepting` であってもボットはフィールドを含めるべきです (SHOULD)。

`R3042`: 受信者は未定義の値を `accepting` と解釈すべきです (SHOULD)。

### <a name="attachments"></a>[添付ファイル]

`attachments` フィールドには、このアクティビティの一部として表示されるオブジェクトの単純なリストが含まれています。 各 `attachments` リスト要素の値は、[添付ファイル](#attachment)型の複合オブジェクトです。

`R3050`: 送信者は、要素を含まない場合、`attachments` フィールドを省略すべきです (SHOULD)。

`R3051`: 送信者は、同じ種類の複数のエンティティを送信することができます (MAY)。

`R3052`: 受信者は、不明な種類の添付ファイルをダウンロード可能なドキュメントとして扱うことができます (MAY)。

`R3053`: 受信者は、レンダリングの制限によって変更が強制される場合 (たとえば、画像の後のドキュメントのグループ化など) を除き、コンテンツの処理時に添付ファイルの順序を保持すべきです (SHOULD)。

### <a name="attachment-layout"></a>添付ファイルのレイアウト

`attachmentLayout` フィールドは、ユーザー インターフェイスのレンダラーに、[`attachments`](#attachments) フィールドに含まれるコンテンツを表示する方法を指示します。 `attachmentLayout` フィールドの値は文字列型であり、`list` および `carousel` の値が定義されています。 既定値は `list` です。

`R3060`: 送信者が `attachmentLayout` フィールドを含める場合、定義された値のみを送信すべきです (SHOULD)。

`R3061`: 受信者は未定義の値を `list` と解釈すべきです (SHOULD)。

### <a name="summary"></a>まとめ

`summary` フィールドには、サポートしていないチャネルの [`attachments`](#attachments) を置き換えるためのテキストが含まれています。 `summary` フィールドの値は文字列型です。

`R3070`: 受信者は、論理的に `text` フィールドに従うように `summary` フィールドを考慮すべきです (SHOULD)。

`R3071`: チャネルは、`summary` フィールドをボットに送信すべきではありません (SHOULD NOT)。

`R3072`: アクティビティ内のすべての添付ファイルを処理できるチャネルは、`summary` フィールドを無視すべきです (SHOULD)。

### <a name="suggested-actions"></a>推奨されるアクション

`suggestedActions` フィールドには、ユーザーに表示することができる対話型アクションのペイロードが含まれています。 `suggestedActions` のサポートとそのマニフェステーションは、チャネルによって大きく変わります。 `suggestedActions` フィールドの値は、[推奨されるアクション](#suggested-actions-2)型の複合オブジェクトです。

### <a name="value"></a>値

`value` フィールドには、送信されるアクティビティに固有のプログラムによるペイロードが含まれます。 その意味と形式については、使用方法について説明しているこのドキュメントの他のセクションで定義されています。

`R3080`: 送信者は、プリミティブ型の `value` フィールド (string、int など) を含めるべきではありません (SHOULD NOT)。 `value` フィールドは複合型にするか、省略すべきです (SHOULD)。

### <a name="expiration"></a>有効期限

`expiration` フィールドには、アクティビティを "期限切れ" と見なすべき時刻が含まれています。このフィールドは受信者に表示すべきではありません。 `expiration` フィールドの値は、文字列内で [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) [[2](#references)] でエンコードされた日時です。

`R3090`: 送信者は、`expiration` フィールドの値を常に UTC 形式ですべきです (SHOULD)。また、値内に明示的な UTC マークとして Z を含めるべきです (SHOULD)。

### <a name="importance"></a>重要度

`importance` フィールドには、アクティビティの相対的な重要度を受信者に通知するための一連の値の列挙が含まれています。  このような重要度のヒントをユーザー エクスペリエンスにマップするのは、受信者の責任です。 `importance` フィールドの値は文字列型であり、`low`、`normal`、および `high` の値が定義されています。 既定値は `normal` です。

`R3100`: 送信者が `importance` フィールドを含める場合、定義された値のみを送信すべきです (SHOULD)。

`R3101`: 受信者は未定義の値を `normal` と解釈すべきです (SHOULD)。

### <a name="deliverymode"></a>DeliveryMode

`deliveryMode` フィールドには、受信者のアクティビティの代替配信パスに通知する一連の値の列挙のいずれかが含まれます。  `DeliveryMode` フィールドの値は文字列型であり、`normal` および `notification` の値が定義されています。 既定値は `normal` です。

`R3110`: 送信者が `deliveryMode` フィールドを含める場合、定義された値のみを送信すべきです (SHOULD)。

`R3111`: 受信者は未定義の値を `normal` と解釈すべきです (SHOULD)。

## <a name="contact-relation-update-activity"></a>連絡先関係の更新アクティビティ

連絡先関係の更新アクティビティは、チャネル内の受信者とユーザー間の関係の変化を通知します。 連絡先関係の更新アクティビティには、一般的にユーザー生成コンテンツは含まれません。 連絡先関係の更新アクティビティによって記述されたリレーションシップの更新は、`from` フィールドのユーザー (常にではないが、更新を開始するユーザーの場合が多い) と `recipient` フィールドのユーザーまたはボットの間に存在します。

連絡関係の更新アクティビティは、`contactRelationUpdate` の `type` 値で識別されます。

### <a name="action"></a>Action

`action` フィールドは、連絡先関係の更新アクティビティの意味を表します。 `action` フィールドの値は文字列です。 `add` および `remove` の値のみが定義されています。これは、`from` および `recipient` フィールドのユーザー/ボット間のリレーションシップを示します。

## <a name="conversation-update-activity"></a>会話の更新アクティビティ

会話更新アクティビティは、会話のメンバー、説明、存在などの変更を示します。 一般的に、会話の更新アクティビティにユーザー生成コンテンツは含まれません。 更新中の会話は `conversation` フィールドに記述されます。

会話の更新アクティビティは、`conversationUpdate` の `type` 値で識別されます。

`R4100`: 送信者は、会話の更新アクティビティに 0 個以上の `membersAdded`、`membersRemoved`、`topicName`、および `historyDisclosed` フィールドを含めることができます (MAY)。

`R4101`: 各 `channelAccount` (`id` フィールドで識別) は `membersAdded` および `membersRemoved` フィールド内に最大で 1 回のみ出現すべきです (SHOULD)。 ID は、両方のフィールドに出現すべきではありません (SHOULD NOT)。 ID は、いずれのフィールド内でも重復すべきではありません (SHOULD NOT)。

`R4102`: チャネル アカウントが会話に追加または会話から削除されなかった場合、チャネル アカウントのフィールド (たとえば、`name`) の変更を示すために、チャネルは会話の更新アクティビティを使用すべきではありません (SHOULD NOT)。

`R4103`: アクティビティがいずれかのフィールドの値の変更を通知していない場合、チャネルは `topicName` または `historyDisclosed` フィールドを送信すべきではありません (SHOULD NOT)。

### <a name="members-added"></a>メンバーの追加

`membersAdded` フィールドには、会話に追加されたチャネル参加者 (ボットまたはユーザー) の一覧が含まれます。 `membersAdded` フィールドの値は、[`channelAccount`](#channel-account) 型の配列です。

### <a name="members-removed"></a>メンバーの削除

`membersRemoved` フィールドには、会話から削除されたチャネル参加者 (ボットまたはユーザー) の一覧が含まれます。 `membersRemoved` フィールドの値は、[`channelAccount`](#channel-account) 型の配列です。

### <a name="topic-name"></a>トピック名

`topicName` フィールドには、会話のテキスト トピックまたは説明が含まれています。 `topicName` フィールドの値は文字列型です。

### <a name="history-disclosed"></a>履歴の公開

`historyDisclosed` フィールドは非推奨です。

`R4110`: 送信者は `historyDisclosed` フィールドを含めるべきではありません (SHOULD NOT)。

## <a name="end-of-conversation-activity"></a>会話の終了アクティビティ

会話の終了アクティビティは、受信者の観点から会話の終了を通知します。 これは、会話が完全に終了したか、終了と区別できない方法で受取人が会話から削除されたためです。 終了中の会話は `conversation` フィールドに記述されます。

会話の終了アクティビティは、`endOfConversation` の `type` 値で識別されます。

`code` および `text` フィールドの両方が省略可能です。

### <a name="code"></a>コード

`code` フィールドには、会話が終了した理由または方法を示すプログラムによる値が含まれています。 `code` フィールドの値は文字列型であり、その意味はアクティビティを送信するチャネルによって定義されています。

### <a name="text"></a>Text

`text` フィールドには、ユーザーに伝達される省略可能なテキスト コンテンツが含まれます。 `text` フィールドの値は文字列型であり、形式はプレーン テキストです。

## <a name="event-activity"></a>イベント アクティビティ

イベント アクティビティは、プログラムによる情報をクライアントまたはチャネルからボットに伝達します。 イベント アクティビティの意味は `name` フィールドに定義されており、チャネルのスコープ内で意味があります。 イベント アクティビティは、対話型の情報 (ボタンのクリックなど) と非対話型の情報 (埋め込み音声モデルを自動的に更新するクライアントの通知など) の両方を伝達するように設計されています。

イベント アクティビティは、[呼び出しアクティビティ](#invoke-activity)に対応する非同期のアクティビティです。 呼び出しとは異なり、イベントはクライアント アプリケーション拡張機能によって拡張されるように設計されています。

イベント アクティビティは、`event` の `type` 値と `name` フィールドの特定の値で識別されます。

`R5000`: クライアントがアプリケーションのカスタマイズを許可している場合、チャネルは、クライアントとボット間でアプリケーション定義のイベント メッセージを許可することができます (MAY)。

### <a name="name"></a>Name

`name` フィールドは、イベントの意味と `value` フィールドのスキーマを制御します。 `name` フィールドの値は文字列型です。

`R5001`: イベント アクティビティには `name` フィールドを含める必要があります (MUST)。

`R5002`: 受信者は、理解できない `name` フィールドがあるイベント アクティビティを無視する必要があります (MUST)。

### <a name="value"></a>値

`value` フィールドには、イベント名の定義に従い、このイベントに固有のパラメーターが含まれています。 `value` フィールドの値は複合型です。

`R5100`: `value` フィールドは、イベント名で定義されている場合、欠落していても空であっても構いません (MAY)。

`R5101`: イベント アクティビティの拡張機能は、`value` フィールドのスキーマを理解するために、アクティビティの `type` および `name` フィールド以外の情報を使用することを受信者に必須にすべきではありません (SHOULD NOT)。

### <a name="relates-to"></a>関連付け先

`relatesTo` フィールドは、別の会話と、必要に応じてそのアクティビティ内の特定のアクティビティを参照します。 `relatesTo` フィールドの値は、会話の参照型の複合オブジェクトです。

`R5200`: `relatesTo` は、`conversation` フィールドで識別される会話内のアクティビティを参照すべきではありません (SHOULD NOT)。

## <a name="invoke-activity"></a>呼び出しアクティビティ

呼び出しアクティビティは、プログラムによる情報をクライアントまたはチャネルからボットに伝達します。また、チャネル内で使用するための対応する戻り値のペイロードがあります。 呼び出しアクティビティの意味は `name` フィールドに定義されており、チャネルのスコープ内で意味があります。 

呼び出しアクティビティは、[イベント アクティビティ](#event-activity)に対応する非同期のアクティビティです。 イベント アクティビティは拡張可能に設計されています。 呼び出しアクティビティは、応答ペイロードをチャネルに返す能力のみが異なります。チャネルは、このような応答ペイロードを処理する場所と方法を決定する必要があるため、呼び出しは、各呼び出し名の明示的なサポートがチャネルに追加されている場合にのみ有効です。 そのため、呼び出しは汎用的なアプリケーション拡張機能のメカニズムになるように設計されていません。

呼び出しアクティビティは、`invoke` の `type` 値と `name` フィールドの特定の値で識別されます。

定義された呼び出しアクティビティの一覧については、「[付録 III](#appendix-iii---protocols-using-the-invoke-activity)」を参照してください。

`R5301`: チャネルは、クライアントとボットの間でアプリケーション定義の呼び出しメッセージを許可すべきではありません (SHOULD NOT)。

### <a name="name"></a>Name

`name` フィールドは、呼び出しの意味と `value` フィールドのスキーマを制御します。 `name` フィールドの値は文字列型です。

`R5401`: 呼び出しアクティビティには `name` フィールドを含める必要があります (MUST)。

`R5402`: 受信者は、理解できない `name` フィールドがあるイベント アクティビティを無視する必要があります (MUST)。

### <a name="value"></a>値

`value` フィールドには、イベント名の定義に従い、このイベントに固有のパラメーターが含まれています。 `value` フィールドの値は複合型です。

`R5500`: `value` フィールドは、イベント名で定義されている場合、欠落していても空であっても構いません (MAY)。

`R5501`: イベント アクティビティの拡張機能は、`value` フィールドのスキーマを理解するために、アクティビティの `type` および `name` フィールド以外の情報を使用することを受信者に必須にすべきではありません (SHOULD NOT)。

### <a name="relates-to"></a>関連付け先

`relatesTo` フィールドは、別の会話と、必要に応じてそのアクティビティ内の特定のアクティビティを参照します。 `relatesTo` フィールドの値は、[会話の参照](#conversation-reference)型の複合オブジェクトです。

`R5600`: `relatesTo` は、`conversation` フィールドで識別される会話内のアクティビティを参照すべきではありません (SHOULD NOT)。

## <a name="installation-update-activity"></a>インストールの更新アクティビティ

インストール更新アクティビティは、チャネルの組織単位 (顧客テナントや "チーム" など) 内のボットのインストールまたはアンインストールを表します。 インストール更新アクティビティは、一般に、チャネルの追加または削除を表していません。

インストールの更新アクティビティは、`installationUpdate` の `type` 値で識別されます。

`R5700`: チャネルは、チャネル内のテナント、チーム、他の組織単位のボットが追加または削除されるときに、インストール アクティビティを送信できます (MAY)。

`R5701`: ボットがチャネルにインストールされるとき、またはボットがチャネルから削除されるとき、チャネルは、インストール アクティビティを送信すべきではありません (SHOULD NOT)。

### <a name="action"></a>Action

`action` フィールドは、インストールの更新アクティビティの意味を表します。 `action` フィールドの値は文字列です。 `add` および `remove` の値のみが定義されています。

## <a name="message-delete-activity"></a>メッセージの削除アクティビティ

メッセージの削除アクティビティは、会話内の既存のメッセージ アクティビティの削除を表しています。 削除されたアクティビティは、アクティビティ内の `id` および `conversation` フィールドから参照されます。

メッセージの削除アクティビティは、`messageDelete` の `type` 値で識別されます。

`R5800`: チャネルは、会話内のすべての削除、会話内の削除の一部 (特定のユーザーによる削除のみなど)、または会話内のアクティビティなしのメッセージの削除アクティビティを送信することができます (MAY)。

`R5801`: チャネルは、ボットで観察されなかった会話やアクティビティに対して、メッセージの削除アクティビティを送信すべきではありません (SHOULD NOT)。

`R5802`: ボットが削除をトリガーした場合、チャネルは、そのボットにメッセージの削除アクティビティを返信すべきではありません (SHOULD NOT)。

`R5803`: チャネルは、種類が `message` でないアクティビティに対応するメッセージの削除アクティビティを送信すべきではありません (SHOULD NOT)。

## <a name="message-update-activity"></a>メッセージの更新アクティビティ

メッセージの更新アクティビティは、会話内の既存のメッセージ アクティビティの更新を表しています。 更新されたアクティビティは、アクティビティ内の `id`および `conversation` フィールドで参照され、メッセージの更新アクティビティには、改訂されたメッセージ アクティビティのすべてのフィールドが含まれます。

メッセージの更新アクティビティは、`messageUpdate` の `type` 値で識別されます。

`R5900`: チャネルは、会話内のすべての更新、会話内の更新の一部 (特定のユーザーによる更新のみなど)、または会話内のアクティビティなしのメッセージの更新アクティビティを送信することができます (MAY)。

`R5901`: ボットが更新をトリガーする場合、チャネルはそのボットにメッセージの更新アクティビティを返すべきではありません (SHOULD NOT)。

`R5902`: チャネルは、種類が `message` でないアクティビティに対応するメッセージの更新アクティビティを送信すべきではありません (SHOULD NOT)。

## <a name="message-reaction-activity"></a>メッセージの反応アクティビティ

メッセージの反応アクティビティは、会話内の既存のメッセージ アクティビティに関するソーシャル インタラクションを表しています。 元のアクティビティは、アクティビティ内の `id` および `conversation` フィールドから参照されます。 `from` フィールドは反応のソース (つまり、メッセージに反応したユーザー) を表します。

メッセージの応答アクティビティは、`messageReaction` の `type` 値で識別されます。

### <a name="reactions-added"></a>反応の追加

`reactionsAdded` フィールドには、このアクティビティに追加された反応の一覧が含まれています。 `reactionsAdded` フィールドの値は、[`messageReaction`](#message-reaction) 型の配列です。

### <a name="reactions-removed"></a>反応の削除

`reactionsRemoved` フィールドには、このアクティビティから削除された反応の一覧が含まれています。 `reactionsRemoved` フィールドの値は、[`messageReaction`](#message-reaction) 型の配列です。

## <a name="typing-activity"></a>入力アクティビティ

入力アクティビティは、ユーザーまたはボットからの継続的な入力を表します。 このアクティビティは、多くの場合、ユーザーがキーストロークを入力したときに送信されますが、ボットが "考え中" であることを示すためにも使用され、ユーザーからの完成の収集などを示すためにも使用できます。

入力アクティビティは、UI 内で 3 秒間持続するように意図されています。

入力アクティビティは、`typing` の `type` 値で識別されます。

`R6000`: 可能な場合、クライアントは入力アクティビティを受信したときに 3 秒間タイピング インジケーターを表示すべきです (SHOULD)。

`R6001`: チャネルに知られている場合を除き、送信者は 3 秒に 1 回より多い頻度で入力アクティビティを送信すべきではありません (SHOULD NOT)  (送信者は、ギャップが生じないように、2 秒ごとに入力アクティビティを送信することができます (MAY))。

`R6002`: チャネルが入力アクティビティに [`id`](#id) を割り当てる場合、ボットとクライアントは入力アクティビティの有効期限が切れる前にそれを削除することができます (MAY)。

`R6003`: 可能な場合、チャネルはボットに入力アクティビティを送信すべきです (SHOULD)。

## <a name="complex-types"></a>複合型

このセクションでは、前述のアクティビティ スキーマ内で使用される複合型を定義します。

### <a name="attachment"></a>Attachment

添付ファイルは、[メッセージ アクティビティ](#message-activity)内に含まれるコンテンツ (カード、バイナリ ドキュメント、およびその他の対話型コンテンツ) です。 テキスト コンテンツと共に表示することが意図されています。 コンテンツは、`contentUrl` フィールド内の URL データ URI または `content` フィールド内のインラインで送信できます。

`R7100`: 送信者は、`content` および `contentUrl` の両フィールドを 1 つの添付ファイルに含めるべきではありません (SHOULD NOT)。

#### <a name="content-type"></a>コンテンツの種類

`contentType` フィールドは、添付ファイルのコンテンツの [MIME メディア タイプ](https://www.iana.org/assignments/media-types/media-types.xhtml) [[8](#references)] を表します。 `contentType` フィールドの値は文字列型です。

#### <a name="content"></a>コンテンツ

指定する場合、`content` フィールドには構造化 JSON オブジェクトの添付ファイルが含まれます。 `content` フィールドの値は、`contentType` フィールドで定義されている複合型です。

`R7110`: 送信者は、添付ファイルの `content` フィールドに JSON プリミティブを含めるべきではありません (SHOULD NOT)。

#### <a name="content-url"></a>コンテンツ URL

指定する場合、`contentUrl` フィールドには添付ファイルのコンテンツの URL が含まれます。 データの URI は、[RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、通常、チャネルによってサポートされています。 `contentUrl` フィールドの値は文字列型です。

`R7120`: 受信者は、HTTPS URL を受け入れるべきです (SHOULD)。

`R7121`: 受信者は、HTTP URL を受け入れることができます (MAY)。

`R7122`: チャネルは、データ URI を受け入れるべきです (SHOULD)。

`R7123`: チャネルは、データ URI をクライアントまたはボットに送信すべきではありません (SHOULD NOT)。

#### <a name="name"></a>Name

`name` フィールドには、添付ファイルの省略可能な名前またはファイル名が含まれています。 `name` フィールドの値は文字列型です。

#### <a name="thumbnail-url"></a>サムネイルの URL

一部のクライアントには、非対話型添付ファイル用または対話型添付ファイル用のプレースホルダーとしてカスタム サムネイルを表示する機能があります。 `thumbnailUrl` フィールドには、このサムネイルのソースを指定します。 データの URI も、[RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、通常は許可されています。

`R7140`: 受信者は、HTTPS URL を受け入れるべきです (SHOULD)。

`R7141`: 受信者は、HTTP URL を受け入れることができます (MAY)。

`R7142`: チャネルは、データ URI を受け入れるべきです (SHOULD)。

`R7143`: チャネルは、`thumbnailUrl` フィールドをボットに送信すべきではありません (SHOULD NOT)。

### <a name="card-action"></a>カード アクション

カード アクションは、カード内または[推奨されるアクション](#suggested-actions)として使用するためのクリック可能または対話型のボタンを表します。 ユーザーからの入力を求めるために使用されます。 名前とは関係なく、カード アクションはカードのみに限定されません。

カード アクションは、チャネルに送信されるときにのみ意味があります。

チャネルは、各アクションがユーザー エクスペリエンスでどのように表示されるかを決定します。 ほとんどの場合、カードはクリック可能です。 つまり、音声入力で選択することができます。 チャネルが対話型のアクティベーション エクスペリエンスを提供しない場合 (たとえば、SMS を介して対話する場合など)、チャネルはアクティベーションをまったくサポートしない可能性があります。 アクションのレンダリング方法の決定は、このドキュメントの他の箇所 (たとえば、カード形式内、[推奨されるアクション](#suggested-actions)の定義内) に記載されている標準の要件によって制御されます。

#### <a name="type"></a>type

`type` フィールドは、ボタンの意味とボタンが有効なときの動作を表します。 `type` フィールドの値は、慣例により、短い文字列 (例: "`openUrl`") です。 各アクションの種類に固有の要件については、以降のセクションを参照してください。

* 種類 `messageBack` のアクションは、チャット システムを介して送信されるテキスト応答を表しています。
* 種類 `imBack` のアクションは、チャット フィードに追加されるテキスト応答を表しています。
* 種類 `postBack` のアクションは、チャット フィードに追加されないテキスト応答を表しています。
* 種類 `openUrl` のアクションは、クライアントによって処理されるハイパーリンクを表します。
* 種類 `downloadFile` のアクションは、ダウンロードされるハイパーリンクを表します。
* 種類 `showImage` のアクションは、表示することができる画像を表します。
* 種類 `signin` のアクションは、クライアントのサインイン システムによって処理されるハイパーリンクを表します。
* 種類 `playAudio` のアクションは、再生することができる音声メディアを表します。
* 種類 `playVideo` のアクションは、再生することができるビデオ メディアを表します。
* 種類 `call` のアクションは、呼び出すことができる電話番号を表します。
* 種類 `payment` のアクションは、支払いを提供する要求を表します。

#### <a name="title"></a>タイトル

`title` フィールドには、ボタンの表面に表示されるテキストが含まれています。 `title` フィールドの値は文字列型であり、マークアップを含んでいません。

このフィールドは、すべての種類のアクションに適用されます。

`R7210`: チャネルは、`title` フィールド (Markdown など) 内のマークアップをすべきではありません (SHOULD NOT)。

#### <a name="image"></a>イメージ

`image` フィールドには、ボタンの表面に表示される画像を参照する URL が含まれています。 データの URI は、[RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、通常、チャネルによってサポートされています。 `image` フィールドの値は文字列型です。

このフィールドは、すべての種類のアクションに適用されます。

`R7220`: チャネルは、HTTPS URL を受け入れるべきです (SHOULD)。

`R7221`: チャネルは、HTTP URL を受け入れることができます (MAY)。

`R7222`: チャネルは、データ URI を受け入れるべきです (SHOULD)。

#### <a name="text"></a>Text

`text` フィールドには、ボタンがクリックされたときにボットに送信され、チャット フィードに含まれるテキスト コンテンツが含まれます。 ボタンの種類に応じて、`text` フィールドのコンテンツが表示される場合と表示されない場合があります。 `text` フィールドには、アクティビティ ルートの [`textFormat`](#text-format) フィールドで制御されるマークアップを含めることができます。 `text` フィールドの値は文字列型です。

このフィールドは、一部の種類のアクションにのみ使用されます。 アクションの各種類の詳細については、このドキュメントで後述します。

`R7230`: `text` フィールドは、コンテンツなしの送信テキストを示す空の文字列を含めることができます (MAY)。

`R7231`: チャネルは、アクティビティ ルートの [`textFormat`](#text-format) フィールドに従って、`text` フィールドのコンテンツを処理すべきです (SHOULD)。

#### <a name="display-text"></a>表示テキスト

`displayText` フィールドには、ボタンがクリックされたときにチャット フィードに含まれるテキスト コンテンツが含まれます。 チャネル内で技術的に可能な場合、`displayText` フィールドのコンテンツを常に表示すべきです (SHOULD)。 `displayText` フィールドには、アクティビティ ルートの [`textFormat`](#text-format) フィールドで制御されるマークアップを含めることができます。 `displayText` フィールドの値は文字列型です。

このフィールドは、一部の種類のアクションにのみ使用されます。 アクションの各種類の詳細については、このドキュメントで後述します。

`R7240`: `displayText` フィールドは、コンテンツなしの送信テキストを示す空の文字列を含めることができます (MAY)。

`R7241`: チャネルは、アクティビティ ルートの [`textFormat`](#text-format) フィールドに従って `displayText` フィールドのコンテンツを処理すべきです (SHOULD)。

#### <a name="value"></a>値

`value` フィールドには、ボタンをクリックしたときにボットに送信されるプログラムによるコンテンツが含まれています。 `value` フィールドのコンテンツは、任意のプリミティブ型または複合型ですが、特定のアクティビティの種類によってこのフィールドは制約されます。

このフィールドは、一部の種類のアクションにのみ使用されます。 アクションの各種類の詳細については、このドキュメントで後述します。

#### <a name="message-back"></a>メッセージ バック

`messageBack` アクションは、チャット システムを介して送信されるテキスト応答を表しています。 メッセージ バックは、次のフィールドを使用します。
* `type` ("`messageBack`")
* `title`
* `image`
* `text`
* `displayText`
* `value` (任意の型)

`R7350`: 送信者は、プリミティブ型の `value` フィールド (string、int など) を含めるべきではありません (SHOULD NOT)。 `value` フィールドは複合型にするか、省略すべきです (SHOULD)。

`R7351`: チャネルは、複合型ではない `value` フィールドを拒否またはドロップすることができます (MAY)。

`R7352`: アクティブにした場合、チャネルは種類が `message` のアクティビティをすべての関連する受信者に送信する必要があります (MUST)。

`R7353`: チャネルがテキストの保存と送信をサポートしている場合、アクションの `text` フィールドのコンテンツは保存され、生成されるメッセージ アクティビティの `text` フィールドで送信される必要があります (MUST)。

`R7352`: チャネルが追加のプログラムによる値の保存と送信をサポートしている場合、`value` フィールドのコンテンツは保存され、生成されるメッセージ アクティビティの `value` フィールドで送信される必要があります (MUST)。

`R7353`: チャネルが、ボットに送信される値とは異なる値をチャット フィードに保存することをサポートしている場合、チャット履歴に `displayText` フィールドを含める必要があります (MUST)。

`R7354`: チャネルが `R7353` をサポートしておらず、チャット フィード内のテキストの記録をサポートしている場合は、チャット履歴に `text` フィールドを含める必要があります (MUST)。

#### <a name="im-back"></a>IM バック

`imBack` アクションは、チャット フィードに追加されるテキスト応答を表しています。 メッセージ バックは、次のフィールドを使用します。
* `type` ("`imBack`")
* `title`
* `image`
* `value` (文字列型)

`R7360`: アクティブにした場合、チャネルは種類が `message` のアクティビティをすべての関連する受信者に送信する必要があります (MUST)。

`R7361`: チャネルがテキストの保存と送信をサポートしている場合、`title` フィールドのコンテンツは保存され、生成されるメッセージ アクティビティの `text` フィールドで送信される必要があります (MUST)。

`R7362`: アクションに `title` フィールドがなく、`value` フィールドが文字列型の場合、チャネルは、生成されたメッセージ アクティビティの `text` フィールドで `value` フィールドのコンテンツを送信することができます (MAY)。

`R7363`: チャネルがチャット フィード内のテキストの記録をサポートしている場合は、`title` フィールドのコンテンツをチャット履歴に含める必要があります (MUST)。

#### <a name="post-back"></a>ポスト バック

`postBack` アクションは、チャット フィードに追加されないテキスト応答を表しています。 ポスト バックは、次のフィールドを使用します。
* `type` ("`postBack`")
* `title`
* `image`
* `value` (文字列型)

`R7370`: アクティブにした場合、チャネルは種類が `message` のアクティビティをすべての関連する受信者に送信する必要があります (MUST)。

`R7371`: ポスト バック アクションをアクティブにするときに、チャネルは、チャット履歴内にテキストを含めるべきではありません (SHOULD NOT)。

`R7372`: チャネルは、文字列型ではない `value` フィールドを拒否またはドロップする必要があります (MUST)。

`R7373`: チャネルがテキストの保存と送信をサポートしている場合、`value` フィールドのコンテンツは保存され、生成されるメッセージ アクティビティの `text` フィールドで送信される必要があります (MUST)。

`R7374`: チャネルが、チャット フィードに履歴を含めずにボットへの送信をサポートできない場合は、`title` フィールドを表示テキストとして使用すべきです (SHOULD)。

#### <a name="open-url-actions"></a>オープン URL アクション

`openUrl` アクションは、クライアントによって処理されるハイパーリンクを表します。 オープン URL は、次のフィールドを使用します。
* `type` ("`openUrl`")
* `title`
* `image`
* `value` (文字列型)

`R7380`: 送信者は、`openUrl` アクションの `value` フィールドに URL を含める必要があります (MUST)。

`R7381`: 受信者は `value` フィールドが欠落しているか、文字列ではない `openUrl` アクションを拒否することができます (MAY)。

`R7382`: 受信者は、[RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、`value` フィールドにデータ URI が含まれる `openUrl` アクションを拒否またはドロップすべきです (SHOULD)。

`R7383`: 受信者は、`value` URI が予期せぬ予期しない URI スキームまたは値である `openUrl` アクションを拒否すべきではありません (SHOULD NOT)。

`R7384`: 特定の URI スキーム (HTTP など) の知識を持つクライアントは、埋め込みレンダラー (ブラウザー コントロールなど) 内の `openUrl` アクションを処理することができます (MAY)。

`R7385`: 利用可能な場合、クライアントは、`R7354` で処理されなかった `openUrl` アクションの処理をオペレーティング システムまたはシェル レベルの URI ハンドラーにデリゲートすべきです (SHOULD)。

#### <a name="download-file-actions"></a>ファイルのダウンロード アクション

`downloadFile` のアクションは、ダウンロードされるハイパーリンクを表します。 ダウンロード ファイルは、次のフィールドを使用します。
* `type` ("`downloadFile`")
* `title`
* `image`
* `value` (文字列型)

`R7390`: 送信者は、`downloadFile` アクションの `value` フィールドに URL を含める必要があります (MUST)。

`R7391`: 受信者は `value` フィールドが欠落しているか、文字列ではない `downloadFile` アクションを拒否することができます (MAY)。

`R7392`: 受信者は、[RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、`value` フィールドにデータ URI が含まれる `downloadFile` アクションを拒否またはドロップすべきです (SHOULD)。

#### <a name="show-image-file-actions"></a>画像ファイルの表示アクション

`showImage` アクションは、表示できる画像を表します。 画像の表示は、次のフィールドを使用します。
* `type` ("`showImage`")
* `title`
* `image`
* `value` (文字列型)

`R7400`: 送信者は、`showImage` アクションの `value` フィールドに URL を含める必要があります (MUST)。

`R7401`: 受信者は `value` フィールドが欠落しているか、文字列ではない `showImage` アクションを拒否することができます (MAY)。

`R7402`: [RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、`value` フィールドがデータ URI である `showImage` アクションを拒否することができます (MAY)。

#### <a name="signin"></a>サインイン

`signin` アクションは、クライアントのサインイン システムによって処理されるハイパーリンクを表します。 サインインには、次のフィールドを使用します。
* `type` ("`signin`")
* `title`
* `image`
* `value` (文字列型)

`R7410`: 送信者は、`signin` アクションの `value` フィールドに URL を含める必要があります (MUST)。

`R7411`: 受信者は `value` フィールドが欠落しているか、文字列ではない `signin` アクションを拒否することができます (MAY)。

`R7412`: 受信者は、[RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、`value` フィールドにデータ URI が含まれる `signin` アクションを拒否またはドロップする必要があります (MUST)。

#### <a name="play-audio"></a>音声の再生

`playAudio` アクションは、再生することができる音声メディアを表します。 音声の再生には、次のフィールドを使用します。
* `type` ("`playAudio`")
* `title`
* `image`
* `value` (文字列型)

`R7420`: アクティブにすると、チャネルはメディア イベントを送信することができます (MAY)。

`R7421`: チャネルは、文字列型ではない `value` フィールドを拒否またはドロップする必要があります (MUST)。

`R7422`: 送信者は、[RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、チャネルがサポートしていることを事前に知らない状態でデータ URI を送信すべきではありません (SHOULD NOT)。

#### <a name="play-video"></a>ビデオの再生

`playAudio` アクションは、再生することができるビデオ メディアを表します。 ビデオの再生には、次のフィールドを使用します。
* `type` ("`playVideo`")
* `title`
* `image`
* `value` (文字列型)

`R7430`: アクティブにすると、チャネルはメディア イベントを送信することができます (MAY)。

`R7431`: チャネルは、文字列型ではない `value` フィールドを拒否またはドロップする必要があります (MUST)。

`R7432`: 送信者は、[RFC 2397](https://tools.ietf.org/html/rfc2397) [[9](#references)] で定義されているように、チャネルがサポートしていることを事前に知らない状態でデータ URI を送信すべきではありません (SHOULD NOT)。

#### <a name="call"></a>呼び出し

`call` アクションは、呼び出すことができる電話番号を表します。 呼び出しには、次のフィールドを使用します。
* `type` ("`call`")
* `title`
* `image`
* `value` (文字列型)

`R7440`: 送信者は、`signin` アクションの `value` フィールドにスキーム `tel` の URL を含める必要があります (MUST)。

`R7441`: 受信者は、`value` フィールドが欠落しているか、`tel` スキームの文字列 URL ではない `signin` アクションを拒否する必要があります (MUST)。

#### <a name="payment"></a>支払い

`payment` アクションは、支払いを提供する要求を表します。 支払いには、次のフィールドを使用します。
* `type` ("`payment`")
* `title`
* `image`
* `value` (複合型の [支払要求](#payment-request))

`R7450`: 送信者は、型 [支払要求](#payment-request) の複合オブジェクトを `payment` アクションの `value` フィールドに含める必要があります (MUST)。

`R7451`: チャネルは、`value` フィールドが欠落しているか、種類が[支払要求](#payment-request)の複合オブジェクトではない `payment` アクションを拒否する必要があります (MUST)。

### <a name="channel-account"></a>チャネル アカウント

チャネル アカウントは、チャネル内の ID を表します。 チャネル アカウントには、そのチャネル内のアカウントを特定して連絡するために使用できる ID が含まれています。 このような ID は単一の名前空間内に存在する場合があります (たとえば Skype ID)。また、多くのサーバー全体でフェデレーションされる場合もあります (電子メール アドレスなど)。 ID に加え、チャネル アカウントには、表示名と Azure Active Directory (AAD) オブジェクト ID が含まれます。

#### <a name="channel-account-id"></a>チャネル アカウント ID

`id` フィールドはチャネル内の識別子とアドレスです。 `id` フィールドの値は文字列です。 電子メール アドレスを使用するチャネル内の例 `id` は "name@example.com" です。

`R7510`: チャネルは、スキーマ内の位置 (`from.id`、`recipient.id`、`membersAdded` など) に関係なく、アカウント ID に同じ値と規則を使用すべきです (SHOULD)。 これにより、ボットとクライアントは、順序文字列比較を使用して、たとえば `conversationUpdate` アクティビティの `membersAdded` フィールドに記述されているかどうかなどを知ることができます。

#### <a name="channel-account-name"></a>チャネル アカウント名

`name` フィールドは、チャネル内の省略可能なフレンドリ名です。 `name` フィールドの値は文字列です。 チャネル内の `name` の例は、"John Doe" です。

#### <a name="channel-account-aad-object-id"></a>チャネル アカウント AAD オブジェクト ID

`aadObjectId` フィールドは、Azure Active Directory (AAD) 内のアカウントのオブジェクト ID に対応する省略可能な ID です。 `aadObjectId` フィールドの値は文字列です。

### <a name="conversation-account"></a>会話アカウント

会話アカウントは、チャネル内の会話の ID を表します。 2 つのアカウント間の単一の会話 (たとえば、SMS) のみをサポートするチャネルでは、会話アカウントは永続的であり、開始または終了が事前に定義されていません。 複数の並行会話 (電子メールなど) をサポートするチャネルでは、各会話は一意の ID を持つ可能性が高くなります。

#### <a name="conversation-account-id"></a>会話アカウント ID

`id` フィールドはチャネル内の識別子です。 この ID の形式はチャネルによって定義され、プロトコル全体では不透明な文字列として使用されます。

チャネルは、会話内のすべての参加者にとって安定した `id` 値を選択すべきです (SHOULD) (たとえば、1 対 1 の会話の `id` フィールドのあまり良くない例は、他の参加者の ID を `id` 値として使用することです。 この結果、各参加者の観点とは異なる `id` になります。 より良い選択肢は、両方の参加者の ID を並べ替え、それらをまとめて連結することです。これは、どちらのパーティーでも同じになります)。

#### <a name="conversation-account-name"></a>会話アカウント名

`name` フィールドは、チャネル内の会話の省略可能なフレンドリ名です。 `name` フィールドの値は文字列です。

#### <a name="conversation-account-aad-object-id"></a>会話アカウントの AAD オブジェクト ID

`aadObjectId` フィールドは、Azure Active Directory (AAD) 内の会話のオブジェクト ID に対応する省略可能な ID です。 `aadObjectId` フィールドの値は文字列です。

#### <a name="conversation-account-is-group"></a>会話アカウントの Is グループ

`isGroup` フィールドは、アクティビティが生成された時点で会話に 2 人より多い参加者が含まれているかどうかを示します。 `isGroup` フィールドの値はブール型です。省略すると、既定値は `false` です。 このフィールドは、通常、チャネルの参加者の @ メンション動作を制御します。また、複数人の参加者が会話内でアクティビティを送受信する能力を持っている場合に限り、`true` に設定すべきです (SHOULD)。

### <a name="entity"></a>エンティティ

エンティティは、アクティビティまたは会話に関するメタデータを伝達します。 各エンティティの意味と形状は `type`フィールドで定義され、追加の型固有のフィールドは `type` フィールドのピアとして配置されます。

`R7600`: 受信者は、種類を理解できないエンティティを無視する必要があります (MUST)。

`R7601`: 受信者は、型を理解していても構文上の誤りなどの理由で処理できないエンティティを無視すべきです (SHOULD)。

既存のエンティティ型をアクティビティのエンティティ形式にプロジェクションするパーティは、`type` フィールド名との競合と、IRI とエンティティ スキーマ間のバインドの一部としてシリアル化要件 `R2001` との非互換を解決することをお勧めします。

#### <a name="type"></a>type

`type` フィールドは必須であり、エンティティの意味と形状を定義します。 `type` は、[IRIs](https://tools.ietf.org/html/rfc3987) [[3](#references)] を含むように意図されていますが、「[付録 I](#appendix-ii---non-iri-entity-types)」に定義されている非 IRI エンティティ型に少数があります。

`R7610`: 送信者は、「[付録 II](#appendix-ii---non-iri-entity-types)」で説明されている型に対してのみ非 IRI 型名を使用すべきです (SHOULD)。

`R7611`: 送信者は、受信者が理解していることを知っている場合は、「[付録 II](#appendix-ii---non-iri-entity-types)」に記述されている型の IRI 型を送信することができます (MAY)。

`R7612`: 送信者は、「[付録 II](#appendix-ii---non-iri-entity-types)」に定義されていないエンティティ型の IRI を使用するか、確立すべきです (SHOULD)。

### <a name="suggested-actions"></a>推奨されるアクション

クライアントの UI 内に対話型のアクション要素を作成するために、メッセージ コンテンツ内に推奨されるアクションを送信することができます。

`R7700`: 推奨されるアクションをレンダリングできる UI をサポートしていないクライアントは、`suggestedActions` フィールドを無視すべきです (SHOULD)。

`R7701`: `actions` フィールドが空の場合、送信者は `suggestedActions` フィールドを省略すべきです (SHOULD)。

#### <a name="to"></a>ターゲット

`to` フィールドには、推奨されるアクションが表示されるチャネル アカウント ID が含まれています。 このフィールドは、会話内の参加者の一部にアクションをフィルター処理するために使用できます。

`R7710`: `to` フィールドが欠落しているか空白の場合、クライアントは、すべての会話参加者に推奨されるアクションを表示すべきです (SHOULD)。

`R7711`: `to` フィールドに無効な ID が含まれている場合、それらの値は無視すべきです (SHOULD)。

#### <a name="actions"></a>Actions

`actions` フィールドには、表示されるアクションの単純なリストが含まれています。 各 `actions` リスト要素の値は、`cardAction` 型の複合オブジェクトです。

### <a name="message-reaction"></a>メッセージの反応

メッセージの反応は、ソーシャル インタラクション ("いいね!"、"+1" など) を表します。 現在、メッセージの反応は 1 つのフィールド (`type` フィールド) のみを伝達しています。

#### <a name="type"></a>type

`type` フィールドは、ソーシャル インタラクションの種類を表します。 `type` フィールドの値は文字列であり、その意味はインタラクションが発生するチャネルによって定義されます。 `like` や `+1` などの一般的な値ですが、規則ではなく規約によって統一されています。

## <a name="references"></a>参照

1. [RFC 2119](https://tools.ietf.org/html/rfc2119)
2. [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)
3. [RFC 3987](https://tools.ietf.org/html/rfc3987)
4. [マークダウン](https://daringfireball.net/projects/markdown/)
5. [ISO 639](https://www.iso.org/iso-639-language-codes.html)
6. [SSML](https://www.w3.org/TR/speech-synthesis/)
7. [XML](https://www.w3.org/TR/xml/)
8. [MIME メディアの種類](https://www.iana.org/assignments/media-types/media-types.xhtml)
9. [RFC 2397](https://tools.ietf.org/html/rfc2397)
10. [ISO 3166-1](https://www.iso.org/iso-3166-country-codes.html)
11. [アダプティブ カード](https://adaptivecards.io)

# <a name="appendix-i---changes"></a>付録 I - 変更

## <a name="2018-02-07"></a>2018-02-07

* 初版のドラフト

# <a name="appendix-ii---non-iri-entity-types"></a>付録 II - 非 IRI エンティティ型

アクティビティ [エンティティ](#entity)は、ユーザーの場所や使用しているメッセージング アプリのバージョンなど、アクティビティに関する追加のメタデータを伝達します。 アクティビティの種類は、IRI であるように意図されていますが、少数の非 IRI 名が一般的に使用されます。 この付録は、サポートされている非 IRI エンティティ型を網羅した一覧です。

| type           | 相当する URI                          | 説明               |
| -------------- | --------------------------------------- | ------------------------- |
| GeoCoordinates | https://schema.org/GeoCoordinates       | Schema.org GeoCoordinates |
| Mention        | https://botframework.com/schema/mention | @-mention                 |
| 場所          | https://schema.org/Place                | Schema.org の場所          |
| Thing          | https://schema.org/Thing                | Schema.org のもの          |
| clientInfo     | 該当なし                                     | Skype クライアント情報         |

### <a name="clientinfo"></a>clientInfo

clientInfo エンティティには、ユーザーのメッセージを送信するために使用されるクライアント ソフトウェアに関する拡張情報が含まれています。 これには 3 つのプロパティが含まれます (いずれも省略可能です)。

`R9201`: ボットは `clientInfo` エンティティを送信すべきではありません (SHOULD NOT)。

`R9202`: 送信者は、1 つまたは複数のフィールドが設定されている場合にのみ `clientInfo` エンティティを含めるべきです (SHOULD)。

#### <a name="locale-deprecated"></a>ロケール (非推奨)

`locale` フィールドにはユーザーのロケールが含まれています。 このフィールドは、アクティビティ ルートの [`locale`](#locale) フィールドを複製します。 `locale` フィールドの値は、文字列内で [ISO 639](https://www.iso.org/iso-639-language-codes.html) [[5](#references)] でエンコードされた日時です。

`clientInfo` 内の `locale` フィールドは非推奨です。

`R9211`: 受信者は、`clientInfo` オブジェクト内の `locale` フィールドを使用すべきではありません (SHOULD NOT)。

`R9212`: 送信者は、互換性の理由から、`clientInfo` 内の `locale` フィールドを設定することができます (MAY)。 以前の受信者との互換性が必要ない場合、送信者は `locale` プロパティを送信すべきではありません (SHOULD NOT)。

#### <a name="country"></a>Country

`country` フィールドにはユーザーの検出された場所が含まれています。 この値は、`country` が検出されたときには [`locale`](#locale) のデータと異なる場合がありますが、通常、`locale` はユーザーまたはアプリケーションの設定です。 `country` フィールドの値は、[ISO 3166-1](https://www.iso.org/iso-3166-country-codes.html) [[10](#references)] の 2 文字または 3 文字の国番号です。

`R9220`: チャネルは、`country` フィールドの任意の値を指定することをクライアントに許可すべきではありません (SHOULD NOT)。 チャネルは、要求を生成する国を確立するために、GPS、位置 API、または IP アドレス検出のようなメカニズムを使用すべきです (SHOULD)。

#### <a name="platform"></a>プラットフォーム

`platform` フィールドは、アクティビティの生成に使用されるメッセージング クライアント プラットフォームを表します。 `platform` フィールドの値は文字列であり、可能な値の一覧とその意味は、それらを送信するチャネルによって定義されます。

永続的なチャット フィードを持つチャネルでは、通常、`platform` はコンテンツの形式ではなく、含めるコンテンツを指定する場合にのみ有用です。 たとえば、モバイル デバイスのユーザーが製品サポートのヘルプを求めた場合、ボットはモバイル デバイス固有のヘルプを生成できます。 ただし、ユーザーは自分の PC 上でチャット フィードを開き直して、モバイル デバイスに変更を加えながらその画面上のチャット フィードを読むことができます。 この状況では、`platform` フィールドはコンテンツに通知することを意図していますが、コンテンツは他のデバイスで表示できる必要があります。

`R9230`: ボットは、送信しているコンテンツが該当するデバイスにのみ表示されるという具体的な知識を持っている場合を除き、応答データの書式設定方法を制御するために `platform` フィールドを使用すべきではありません (SHOULD NOT)。

# <a name="appendix-iii---protocols-using-the-invoke-activity"></a>付録 III - 呼び出しアクティビティを使用するプロトコル

[呼び出しアクティビティ](#invoke-activity)は、Bot Framework チャネルでサポートされているプロトコル内でのみ使用するように設計されています (つまり、汎用的な拡張メカニズムではありません)。 この付録には、このアクティビティを使用するすべての Bot Framework プロトコルの一覧が記載されています。

## <a name="payments"></a>入金額

Bot Framework の支払いプロトコルでは、呼び出しを使用して送料と税率を計算し、完了した支払いの確実な確認を伝達します。

支払いプロトコルは、3 つの操作 (呼び出しアクティビティの `name` フィールドで定義されています) を定義します。
* `payment/shippingAddressChange`
* `payment/shppingOptionsChange`
* `payment/paymentResponse`

詳細については、「[支払いの要求](https://docs.microsoft.com/en-us/bot-framework/dotnet/bot-builder-dotnet-request-payment)」ページを参照してください。

## <a name="teams-compose-extension"></a>Teams の作成拡張機能

Microsoft Teams チャネルは、[作成拡張機能](https://docs.microsoft.com/en-us/microsoftteams/platform/concepts/messaging-extensions)のために呼び出しを使用します。 この呼び出しの使用は、Microsoft Teams に固有のものです。



